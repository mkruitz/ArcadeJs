<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Collision checks</title>
    <script src="lib/crafty-min-0.9.0.js"></script>
    <script>
      Game = {
        tileSize: 20,
        boardSize: 9,

        start: function() {
          const boardSizeInPx = Game.boardSize * Game.tileSize;
          Crafty.init(boardSizeInPx, boardSizeInPx);
          Crafty.background('#DDDDDD');

          let tiles = [
            Crafty.e('Tile')
              .size(5, 3)
              .position(1, 2)
              .color('#001f3f')
              ,
            Crafty.e('Tile')
              .position(2, 3)
              .color('#FF4136'),
            Crafty.e('Tile')
              .size(1, 3)
              .position(4, 1)
              .color('#3D9970'),
            Crafty.e('Player, Tile')
              .position(7, 3)
              .color('#FF851B')
            ];

          const blue = tiles[0];
          const red = tiles[1];
          const green = tiles[2];

          console.log('--- Contains ---');
          console.log('Blue contains Red (yes)', blue.contains(red));
          console.log('Blue contains Green (no)', blue.contains(green));
          console.log('Red contains Blue (no)', red.contains(blue));
          console.log('Red contains Green (no)', red.contains(green));
          console.log('Green contains Blue (no)', green.contains(blue));
          console.log('Green contains Red (no)', green.contains(red));

          console.log('--- Within ---');
          console.log('Blue within Red (no)', blue.within(red));
          console.log('Blue within Green (no)', blue.within(green));
          console.log('Red within Blue (yes)', red.within(blue));
          console.log('Red within Green (no)', red.within(green));
          console.log('Green within Blue (no)', green.within(blue));
          console.log('Green within Red (no)', green.within(red));

          console.log('--- Intersect ---');
          console.log('Blue intersect Red (yes)', blue.intersect(red));
          console.log('Blue intersect Green (yes)', blue.intersect(green));
          console.log('Red intersect Blue (yes)', red.intersect(blue));
          console.log('Red intersect Green (no)', red.intersect(green));
          console.log('Green intersect Blue (yes)', green.intersect(blue));
          console.log('Green intersect Red (no)', green.intersect(red));
        }
      };

      Crafty.c('Tile', {
        init: function () {
          this.requires('2D, Canvas, Color');

          this.w = Game.tileSize;
          this.h = Game.tileSize;
        },

        size: function(width, height) {
          this.w = Game.tileSize * width;
          this.h = Game.tileSize * height;

          return this;
        },

        position: function(x, y) {
          this.x = Game.tileSize * x;
          this.y = Game.tileSize * y;

          return this;
        }
      });

      Crafty.c('Player', {
        init: function () {
          this
            .requires('Fourway, Collision')
            .fourway(Game.tileSize)
            .onHit('Tile', this.onCollision);
        },

        onCollision: function(hits) {
          const thisSides = this.getSides(this);
          const v = this.velocity();
          console.log('--- onCollision ---');
          console.debug('this.sides', thisSides);
          console.debug('v.x', v.x, 'v.y', v.y);

          const collisionSides = {
            left: false,
            right: false,
            top: false,
            bottom: false
          };

          for(let i = 0, l = hits.length; i < l; i++) {
            const hitObj = hits[i].obj;
            const hitSides = this.getSides(hitObj);
            console.debug('hit.sides', hitSides);

            if(v.x > 0) {
              // Moving right
              collisionSides.right = collisionSides.right || thisSides.right > hitSides.left;
            }
            else if(v.x < 0) {
              // Moving left
              collisionSides.left = collisionSides.left || thisSides.left < hitSides.right;
            }
            if(v.y > 0) {
              // Moving Down
              collisionSides.bottom = collisionSides.bottom || thisSides.top < hitSides.bottom;
            }
            else if(v.y < 0) {
              // Moving Up
              collisionSides.top = collisionSides.top || thisSides.bottom > hitSides.top;
            }
          }

          console.debug(collisionSides);
          if(collisionSides.left) { console.log('hit left'); }
          if(collisionSides.right) { console.log('hit right'); }
          if(collisionSides.top) { console.log('hit top'); }
          if(collisionSides.bottom) { console.log('hit bottom'); }
        },

        getSides: function(obj) {
          return {
            left: obj.x,
            right : obj.x + obj.w,
            top: obj.y,
            bottom: obj.y + obj.h
          };
        }
      });

      window.addEventListener('load', Game.start);
    </script>
    <style>
        body { margin: 0; padding: 100px; }
    </style>
</head>
<body>

</body>
</html>